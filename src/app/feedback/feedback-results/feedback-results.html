<div class="typography feedback-results-container">
  @if (results() === null || feedback() === null) {
    <p>Lade Feedback-Ergebnisse...</p>
  } @else {
    <h1>Feedback</h1>
    <h2>
      {{ feedback()?.course_id }}
      {{ feedback()?.course_name }}
    </h2>
    <div class="flex flex-col gap-5">
      @for (result of result_order(); track result.key) {
        <div class="border border-gray-300 p-5 rounded-sm shadow-lg">
          <p class="title">{{ result.title }}</p>
          @if (result.type === 'histogram') {
            @let histogramData = getHistogramData(result.key);
            @let sum = getHistogramSum(histogramData);
            <div
              class="px-20 w-full grid auto-cols-fr grid-flow-col gap-5 h-75 border-gray-300"
            >
              @for (label of result.labelMap; track label.value) {
                <div
                  class="bg-blue-200 rounded-sm w-full mt-auto"
                  style="height: {{
                    ((histogramData[label.value] || 0) / sum) * 100
                  }}%;"
                ></div>
              }
            </div>
            <div class="px-20 w-full grid auto-cols-fr grid-flow-col gap-5">
              @for (label of result.labelMap; track label.value) {
                <p class="w-full text-center">
                  {{ label.text }} ({{ histogramData[label.value] || 0 }})
                </p>
              }
            </div>
          }
          @if (result.type === 'text') {
            <div class="flex flex-row w-full gap-3 flex-wrap">
              @for (answer of getTextAnswers(result.key); track answer) {
                <span
                  class="bg-gray-20 border-2 border-gray-300 rounded-sm p-3"
                >
                  {{ answer }}
                </span>
              }
            </div>
          }
        </div>
      }
    </div>
  }
</div>
