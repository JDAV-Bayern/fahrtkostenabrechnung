<h2 class="typography">Zusammenfassung</h2>

<table class="mb-4 [&_td]:p-1">
  <tr>
    <td>Veranstaltung:</td>
    <td>
      @if (meeting.type === 'course') {
        {{ meeting.code }} &ndash;
      }
      {{ meeting.name }}
    </td>
  </tr>
  <tr>
    <td>Teilnehmer:</td>
    <td>{{ participant.givenName }} {{ participant.familyName }}</td>
  </tr>
  <tr>
    <td>IBAN:</td>
    <td>{{ participant.iban }}</td>
  </tr>
</table>

<table class="mb-4 [&_td]:p-1">
  @for (entry of report.categories | keyvalue: originalOrder; track entry.key) {
    <tr>
      <td>{{ entry.key | expenseType }}:</td>
      <td class="w-20 text-right">{{ entry.value | currency }}</td>
    </tr>
  }
  <tr class="font-bold">
    <td>Erstattungsbetrag:</td>
    <td class="w-20 text-right">{{ report.total | currency }}</td>
  </tr>
</table>

<div class="typography">
  @if (report.totalReduced) {
    <p>
      <b
        >Da deine Sektion nicht in Bayern liegt, ist der Erstattungsbetrag gemäß
        unserer Reisekostenrichtlinien auf
        {{ report.total | currency }} begrenzt.</b
      >
    </p>
  }
  @for (warning of getWarnings(); track warning) {
    <p><b>Warnung</b> {{ warning }}</p>
  }
</div>

<div class="form-group" [formGroup]="form">
  <label for="note">Bemerkung zu deiner Abrechnung</label>
  <textarea class="form-control" rows="4" formControlName="note" id="note">
  </textarea>
</div>

@if (report.receiptsRequired) {
  <div class="typography">
    <h2>Belege</h2>
    <p>Bitte denke daran, dass wir die Belege für deine Tickets benötigen.</p>
    @if (reimbursement.meeting.type === 'committee') {
      <p>
        Falls du eine BahnCard benutzt hast, hänge bitte die Rechnung für diese
        an. Die BahnCard wird für Gremien im angezeigten Betrag aktuell nicht
        berücksichtigt, wird jedoch durch die LGS entsprechend zusätzlich
        erstattet.
      </p>
    }
  </div>
  <ngx-file-drop
    (onFileDrop)="fileDropped($event)"
    [accept]="'.pdf,.jpg,.png,.jpeg,.JPG,.JPEG,.PDF,.PNG'"
  >
    <ng-template
      ngx-file-drop-content-tmp
      let-openFileSelector="openFileSelector"
    >
      <button
        jdavButton
        type="button"
        variant="ghost"
        (click)="openFileSelector()"
      >
        <span class="material-symbols-outlined">upload_file</span>
        Beleg hinzufügen
      </button>
    </ng-template>
  </ngx-file-drop>
  @let files = form.controls.files.value;
  @if (files.length) {
    <fieldset class="mt-4 border border-gray-300 rounded-sm">
      <legend class="ml-2 text-gray-400">Belege</legend>
      @for (file of files; track file) {
        <p class="flex items-center">
          <button
            jdavButton
            type="button"
            variant="ghost"
            (click)="removeFile(file.name)"
          >
            <span class="material-symbols-outlined">delete</span>
          </button>
          {{ file.name }}
        </p>
      }
    </fieldset>
  }
}
