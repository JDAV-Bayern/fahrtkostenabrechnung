<div class="step-content">
  <div class="step-box">
    <h2>Kontodaten</h2>

    <form [formGroup]="formGroup" (ngSubmit)="submitForm()">
      <div class="form-group">
        <label for="inputIBAN">IBAN</label>
        <input
          type="text"
          (change)="saveForm()"
          class="form-control"
          formControlName="inputIBAN"
          id="inputIBAN"
          placeholder="IBAN"
        />
        <div
          *ngIf="
            formGroup.get('inputIBAN')?.hasError('ibanInvalid') &&
            formGroup.get('inputIBAN')?.touched
          "
          class="error-message"
        >
          Bitte gib eine gültige IBAN ein.
        </div>
      </div>
      <div
        class="form-group"
        *ngIf="
          !r().participantDetails.iban.startsWith('DE') &&
          formGroup.get('inputIBAN')?.touched
        "
      >
        <label for="inputBIC"
          >BIC (nur bei ausländischen Kreditinstituten notwendig)</label
        >
        <input
          type="text"
          (change)="saveForm()"
          class="form-control"
          formControlName="inputBIC"
          id="inputBIC"
          placeholder="BIC"
        />
      </div>
      <div class="form-group">
        <label for="inputNote">Bemerkung zu deiner Abrechnung</label>
        <textarea
          (change)="saveForm()"
          class="form-control textarea"
          rows="4"
          formControlName="inputNote"
          id="inputNote"
          placeholder="Bemerkung"
        ></textarea>
      </div>
    </form>

    <h2>Zusammenfassung</h2>
    Erstattungsbetrag: {{ getSum().toFixed(2) }}€<br />
    <p *ngFor="let error of getErrors()"><b>Fehler</b> {{ error }}</p>
    <p *ngFor="let warning of getWarnings()"><b>Warnung</b> {{ warning }}</p>
    <p *ngFor="let info of getInfos()"><b>Info</b> {{ info }}</p>

    <h2>Belege</h2>
    <ngx-file-drop
      (onFileDrop)="fileDropped($event)"
      [accept]="'.pdf,.jpg,.png'"
    >
      <ng-template
        ngx-file-drop-content-tmp
        let-openFileSelector="openFileSelector"
      >
        <button type="button" class="fileupload" (click)="openFileSelector()">
          <span class="material-symbols-outlined">&#xe9fc;</span>
          Beleg hinzufügen
        </button>
      </ng-template>
    </ngx-file-drop>

    <fieldset *ngIf="files.length" class="files-list">
      <legend style="color: #999">Belege</legend>
      <p class="file-list-entry" *ngFor="let file of files">
        <span
          style="cursor: pointer"
          class="material-symbols-outlined"
          (click)="removeFile(file.name)"
          >&#xe872;</span
        >{{ file.name }}
      </p>
    </fieldset>
  </div>

  <div class="button-container">
    <div class="left-button-container">
      <button (click)="back()" class="gray-button">Zurück</button>
    </div>
    <div class="right-button-container">
      <app-progress-indicator *ngIf="loading"></app-progress-indicator>
      <button
        (click)="continue()"
        *ngIf="!loading"
        [class.green-button]="isReimbursementValid()"
        [class.disabled-button]="!isReimbursementValid()"
      >
        PDF herunterladen
      </button>
    </div>
  </div>
</div>
<div style="position: absolute; top: 2000px">
  <app-pdf-view
    *ngIf="showPdf"
    [reimbursement]="r()"
    (fullyRendered)="pdfFullyRendered()"
  ></app-pdf-view>
</div>
